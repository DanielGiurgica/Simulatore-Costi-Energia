<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore Energia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        select, input {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
        }
        p.error {
            color: red;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<div class="container" id="fase1">
    <h1>Benvenuto nel Simulatore Energia</h1>
    <p>Per iniziare, seleziona il tipo di bolletta e il tipo di utente:</p>

    <label for="tipo-bolletta">Tipo di Bolletta</label>
    <select id="tipo-bolletta">
        <option value="">Seleziona Tipo di Bolletta</option>
        <option value="mensile">Mensile</option>
        <option value="bimestrale">Bimestrale</option>
    </select>

    <label for="tipo-utente">Tipo di Utente</label>
    <select id="tipo-utente">
        <option value="">Seleziona Tipo di Utente</option>
        <option value="residente">Residente</option>
        <option value="non-residente">Non Residente</option>
        <option value="partita-iva">Partita IVA</option>
    </select>

    <button id="prosegui" onclick="passaFase()">Prosegui</button>
    <p id="errore" class="error hidden">Per favore, seleziona tutti i campi richiesti.</p>
</div>

<div class="container hidden" id="fase2">
    <h1>Inserisci i Dati di Consumo</h1>
    
    <label for="costo-attuale">Costo Attuale Energia (€)</label>
    <input type="number" id="costo-attuale" required>
    
    <label for="consumo-attuale">Consumo Attuale (kWh)</label>
    <input type="number" id="consumo-attuale" required>
    
    <label for="consumo-annuale">Consumo Annuale Attuale (kWh)</label>
    <input type="number" id="consumo-annuale" required>
    
    <button onclick="calcolaRisultato()">Calcola Offerte</button>
</div>

<script>
    // Funzione per verificare se i campi obbligatori sono stati selezionati
    function passaFase() {
        const tipoBolletta = document.getElementById('tipo-bolletta').value;
        const tipoUtente = document.getElementById('tipo-utente').value;
        
        if (tipoBolletta === '' || tipoUtente === '') {
            document.getElementById('errore').classList.remove('hidden');
        } else {
            // Nasconde la fase iniziale e mostra la fase 2
            document.getElementById('fase1').classList.add('hidden');
            document.getElementById('fase2').classList.remove('hidden');
        }
    }

    function calcolaRisultato() {
        // Recupera i dati inseriti
        const costoAttuale = parseFloat(document.getElementById('costo-attuale').value);
        const consumoAttuale = parseFloat(document.getElementById('consumo-attuale').value);
        const consumoAnnuale = parseFloat(document.getElementById('consumo-annuale').value);
        
        if (isNaN(costoAttuale) || isNaN(consumoAttuale) || isNaN(consumoAnnuale)) {
            alert("Per favore, inserisci valori validi.");
            return;
        }

        // Considera un margine di errore del 10% sui consumi
        const consumoCorretto = consumoAttuale * 1.1;

        // Recupera i dati selezionati
        const tipoBolletta = document.getElementById('tipo-bolletta').value;
        const tipoUtente = document.getElementById('tipo-utente').value;

        // Costi di commercializzazione, moltiplicato per 2 se bimestrale
        let costoCommercializzazione = (tipoBolletta === 'bimestrale') ? 2 : 1;

        // Aggiungi un costo extra di 12€/mese se Non Residente
        let costoExtraNonResidente = (tipoUtente === 'non-residente') ? 12 : 0;

        // Calcolo dei costi per ciascuna offerta
        let costoFlex = (consumoCorretto * costoAttuale) + (costoCommercializzazione * 10) + costoExtraNonResidente;
        let costoFix = (consumoCorretto * costoAttuale) + (costoCommercializzazione * 15) + costoExtraNonResidente;

        // Costo per le offerte Light, Full e Maxi
        let costoLight = 40 + (consumoAnnuale > 1500 ? (consumoAnnuale - 1500) * 0.45 : 0) + costoExtraNonResidente;
        let costoFull = 60 + (consumoAnnuale > 2500 ? (consumoAnnuale - 2500) * 0.45 : 0) + costoExtraNonResidente;
        let costoMaxi = 90 + (consumoAnnuale > 4000 ? (consumoAnnuale - 4000) * 0.45 : 0) + costoExtraNonResidente;

        // Trova l'offerta più conveniente
        let offerte = [
            { nome: "Flex", costo: costoFlex },
            { nome: "Fix", costo: costoFix },
            { nome: "Light", costo: costoLight },
            { nome: "Full", costo: costoFull },
            { nome: "Maxi", costo: costoMaxi }
        ];

        let offertaConveniente = offerte.reduce((prev, curr) => (prev.costo < curr.costo ? prev : curr));

        // Mostra il risultato
        alert(`Offerta più conveniente: ${offertaConveniente.nome}\nCosto: €${offertaConveniente.costo.toFixed(2)}`);
    }
</script>

</body>
</html>
