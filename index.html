<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulatore Energia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    .hidden {
      display: none;
    }
    .section {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      padding: 5px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div id="welcome" class="section">
    <h1>Benvenuto nel simulatore</h1>
    <button onclick="startSimulation()">Inizia</button>
  </div>

  <div id="step1" class="section hidden">
    <label for="billingType">Tipo di bolletta:</label>
    <select id="billingType">
      <option value="Mensile">Mensile</option>
      <option value="Bimestrale">Bimestrale</option>
    </select>

    <label for="userType">Tipo di utente:</label>
    <select id="userType">
      <option value="Residente">Residente</option>
      <option value="Non Residente">Non Residente</option>
      <option value="Partita IVA">Partita IVA</option>
    </select>

    <button onclick="showInputs()">Avanti</button>
  </div>

  <div id="step2" class="section hidden">
    <label for="costoAttuale">Costo Attuale Energia (€):</label>
    <input type="number" id="costoAttuale">

    <label for="consumoAttuale">Consumo Attuale (kW):</label>
    <input type="number" id="consumoAttuale">

    <label for="consumoAnnuale">Consumo Annuale Attuale (kW):</label>
    <input type="number" id="consumoAnnuale">

    <h3>Inserire i dati per il calcolo dell'offerta Flex</h3>
    <label for="punAttuale">PUN della bolletta attuale:</label>
    <input type="number" id="punAttuale">

    <label for="spread">Spread con Fastweb (€):</label>
    <input type="number" id="spread">

    <label for="commercialeFlex">Costo di Commercializzazione Fastweb:</label>
    <input type="number" id="commercialeFlex">

    <h3>Inserire i dati per il calcolo dell'offerta Fix</h3>
    <label for="punFisso">PUN Fisso Fastweb:</label>
    <input type="number" id="punFisso">

    <label for="commercialeFix">Costo di Commercializzazione Fastweb:</label>
    <input type="number" id="commercialeFix">

    <button onclick="calcolaOfferte()">Calcola Offerta</button>
  </div>

  <div id="risultati" class="section hidden">
    <h2>Risultati della simulazione</h2>
    <p id="risultatoText"></p>
  </div>

  <script>
    function startSimulation() {
      document.getElementById('welcome').classList.add('hidden');
      document.getElementById('step1').classList.remove('hidden');
    }

    function showInputs() {
      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
    }

    function calcolaOfferte() {
      const billingType = document.getElementById('billingType').value;
      const isBimestrale = billingType === 'Bimestrale';

      const consumo = parseFloat(document.getElementById('consumoAttuale').value);
      const consumoAnnuale = parseFloat(document.getElementById('consumoAnnuale').value);
      const costoAttuale = parseFloat(document.getElementById('costoAttuale').value);

      const punAttuale = parseFloat(document.getElementById('punAttuale').value);
      const spread = parseFloat(document.getElementById('spread').value);
      let commercialeFlex = parseFloat(document.getElementById('commercialeFlex').value);
      if (isBimestrale) commercialeFlex *= 2;

      const punFisso = parseFloat(document.getElementById('punFisso').value);
      const commercialeFix = parseFloat(document.getElementById('commercialeFix').value);

      // Offerta Flex
      const costoFlex = (consumo * (punAttuale + spread)) + commercialeFlex;

      // Offerta Fix
      const costoFix = (consumo * punFisso) + commercialeFix;

      // Offerta Light
      let baseLight = isBimestrale ? 80 : 40;
      let extraLight = consumoAnnuale > 1500 ? (consumoAnnuale - 1500) * 0.45 : 0;
      const costoLight = (baseLight * 12 / (isBimestrale ? 2 : 1)) + extraLight;

      // Offerta Full
      let baseFull = isBimestrale ? 120 : 60;
      let extraFull = consumoAnnuale > 2500 ? (consumoAnnuale - 2500) * 0.45 : 0;
      const costoFull = (baseFull * 12 / (isBimestrale ? 2 : 1)) + extraFull;

      // Offerta Maxi
      let baseMaxi = isBimestrale ? 180 : 90;
      let extraMaxi = consumoAnnuale > 4000 ? (consumoAnnuale - 4000) * 0.45 : 0;
      const costoMaxi = (baseMaxi * 12 / (isBimestrale ? 2 : 1)) + extraMaxi;

      const offerte = [
        { nome: 'Flex', costo: costoFlex },
        { nome: 'Fix', costo: costoFix },
        { nome: 'Light', costo: costoLight },
        { nome: 'Full', costo: costoFull },
        { nome: 'Maxi', costo: costoMaxi }
      ];

      offerte.sort((a, b) => a.costo - b.costo);

      document.getElementById('step2').classList.add('hidden');
      document.getElementById('risultati').classList.remove('hidden');
      document.getElementById('risultatoText').innerText = `L'offerta più conveniente è: ${offerte[0].nome} con un costo annuo stimato di € ${offerte[0].costo.toFixed(2)}`;
    }
  </script>
</body>
</html>
