<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore Offerta Energetica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fff8e1; /* Giallo chiaro */
            color: black;
            padding: 20px;
        }
        h1, h3 {
            color: black;
        }
        .hidden {
            display: none;
        }
        .button {
            background-color: yellow;
            color: black;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background-color: orange;
        }
        .inputField {
            margin-top: 10px;
            padding: 8px;
            width: 100%;
            max-width: 300px;
            font-size: 16px;
            background-color: #444;
            color: white;
            border: 1px solid yellow;
        }
        .result {
            margin-top: 20px;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
        }
        .result p {
            margin: 10px 0;
        }
        .label {
            margin-top: 10px;
            color: black;
        }
    </style>
</head>
<body>
    <h1>Benvenuto nel Simulatore di Offerta Energetica</h1>
    <button id="startBtn" class="button">Inizia</button>

    <div id="selectionSection" class="hidden">
        <label class="label" for="billType">Tipo di bolletta:</label>
        <select id="billType" class="inputField">
            <option value="mensile">Mensile</option>
            <option value="bimestrale">Bimestrale</option>
        </select>

        <label class="label" for="userType">Tipo di utente:</label>
        <select id="userType" class="inputField">
            <option value="residente">Residente</option>
            <option value="non_residente">Non Residente</option>
            <option value="partita_iva">Partita IVA</option>
        </select>

        <label class="label" for="currentCost">Costo Attuale Energia (€):</label>
        <input type="number" id="currentCost" class="inputField" required>

        <label class="label" for="currentConsumption">Consumo Attuale (kWh):</label>
        <input type="number" id="currentConsumption" class="inputField" required>

        <label class="label" for="currentAnnualConsumption">Consumo Annuale Attuale (kWh):</label>
        <input type="number" id="currentAnnualConsumption" class="inputField" required>

        <label class="label" for="currentPUN">PUN della bolletta attuale:</label>
        <input type="number" id="currentPUN" class="inputField" step="any" required>

        <label class="label" for="spread">Spread con Fastweb (€):</label>
        <input type="number" id="spread" class="inputField" step="any" required>

        <label class="label" for="commercialCost">Costo di Commercializzazione Fastweb (€):</label>
        <input type="number" id="commercialCost" class="inputField" required>

        <label class="label" for="fixedPUN">PUN Fisso Fastweb:</label>
        <input type="number" id="fixedPUN" class="inputField" step="any" required>

        <label class="label" for="fixedCommercialCost">Costo di Commercializzazione Fastweb:</label>
        <input type="number" id="fixedCommercialCost" class="inputField" required>

        <button id="calculateBtn" class="button">Calcola</button>
    </div>

    <div id="resultSection" class="hidden result">
        <h3>Risultati della simulazione</h3>
        <div id="resultDetails"></div>
    </div>

    <script>
        document.getElementById("startBtn").addEventListener("click", () => {
            document.querySelector("h1").classList.add("hidden");
            document.getElementById("startBtn").classList.add("hidden");
            document.getElementById("selectionSection").classList.remove("hidden");
        });

        document.getElementById("calculateBtn").addEventListener("click", () => {
            const billType = document.getElementById("billType").value;
            const userType = document.getElementById("userType").value;
            const currentCost = parseFloat(document.getElementById("currentCost").value);
            const currentConsumption = parseFloat(document.getElementById("currentConsumption").value);
            const currentAnnualConsumption = parseFloat(document.getElementById("currentAnnualConsumption").value);
            const currentPUN = parseFloat(document.getElementById("currentPUN").value);
            const spread = parseFloat(document.getElementById("spread").value);
            const commercialCost = parseFloat(document.getElementById("commercialCost").value);
            const fixedPUN = parseFloat(document.getElementById("fixedPUN").value);
            const fixedCommercialCost = parseFloat(document.getElementById("fixedCommercialCost").value);

            // Aggiungere scarto del 10% sul consumo
            const adjustedConsumption = currentConsumption * 1.10;

            // Aggiungere costo se utente "Non Residente"
            const additionalCost = (userType === "non_residente") ? 12 : 0;

            // Calcolare il prezzo al kWh attuale
            const currentPricePerKWh = currentCost / currentConsumption;

            // Calcoli delle offerte
            // Offerta Flex
            const flexCost = (adjustedConsumption * (currentPUN + spread)) + commercialCost + additionalCost;

            // Offerta Fix
            const fixCost = (adjustedConsumption * fixedPUN) + fixedCommercialCost + additionalCost;

            // Offerta Light
            const lightBaseCost = (billType === "mensile") ? 40 : 80;
            let lightCost = lightBaseCost * 12;
            if (currentAnnualConsumption > 1500) {
                const extraKWh = currentAnnualConsumption - 1500;
                lightCost += extraKWh * 0.45;
            }

            // Offerta Full
            const fullBaseCost = (billType === "mensile") ? 60 : 120;
            let fullCost = fullBaseCost * 12;
            if (currentAnnualConsumption > 2500) {
                const extraKWh = currentAnnualConsumption - 2500;
                fullCost += extraKWh * 0.45;
            }

            // Offerta Maxi
            const maxiBaseCost = (billType === "mensile") ? 90 : 180;
            let maxiCost = maxiBaseCost * 12;
            if (currentAnnualConsumption > 4000) {
                const extraKWh = currentAnnualConsumption - 4000;
                maxiCost += extraKWh * 0.45;
            }

            // Determina l'offerta più conveniente
            const allCosts = {
                "Flex": flexCost,
                "Fix": fixCost,
                "Light": lightCost,
                "Full": fullCost,
                "Maxi": maxiCost
            };

            const bestOffer = Object.keys(allCosts).reduce((a, b) => allCosts[a] < allCosts[b] ? a : b);

            // Mostra i risultati
            let resultText = `
                <p>Prezzo al kWh della bolletta attuale: ${currentPricePerKWh.toFixed(4)} €/kWh</p>
                <p>L'offerta più conveniente è: <strong>${bestOffer}</strong></p>
                <p>Motivo: </p>
            `;

            // Motivazione per la scelta dell'offerta migliore
            if (bestOffer === "Flex") {
                resultText += `<p>La Flex conviene per il suo PUN variabile e la combinazione con lo spread e il costo di commercializzazione.</p>`;
            } else if (bestOffer === "Fix") {
                resultText += `<p>La Fix conviene per il suo PUN fisso che consente una previsione stabile dei costi.</p>`;
            } else if (bestOffer === "Light") {
                resultText += `<p>L'Offerta Light conviene perchè il consumo annuo dell'utente è basso e non supera i limiti, mantenendo il costo fisso a un prezzo conveniente.</p>`;
            } else if (bestOffer === "Full") {
                resultText += `<p>L'Offerta Full offre una buona combinazione di prezzo e consumo, ma solo per consumi più alti.</p>`;
            } else {
                resultText += `<p>L'Offerta Maxi conviene per consumi molto elevati, ma non è adatta a consumi più bassi come il tuo.</p>`;
            }

            document.getElementById("resultDetails").innerHTML = resultText;
            document.getElementById("selectionSection").classList.add("hidden");
            document.getElementById("resultSection").classList.remove("hidden");
        });
    </script>
</body>
</html>
