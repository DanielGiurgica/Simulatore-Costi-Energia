<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore Offerta Energetica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .hidden {
            display: none;
        }
        .result {
            margin-top: 20px;
        }
        label {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Benvenuto nel Simulatore di Offerta Energetica</h1>
    <button id="startBtn">Inizia</button>

    <div id="selectionSection" class="hidden">
        <label for="billType">Tipo di bolletta:</label>
        <select id="billType">
            <option value="mensile">Mensile</option>
            <option value="bimestrale">Bimestrale</option>
        </select>

        <label for="userType">Tipo di utente:</label>
        <select id="userType">
            <option value="residente">Residente</option>
            <option value="non_residente">Non Residente</option>
            <option value="partita_iva">Partita IVA</option>
        </select>

        <label for="currentCost">Costo Attuale Energia (€):</label>
        <input type="number" id="currentCost" required>

        <label for="currentConsumption">Consumo Attuale (kWh):</label>
        <input type="number" id="currentConsumption" required>

        <label for="currentAnnualConsumption">Consumo Annuale Attuale (kWh):</label>
        <input type="number" id="currentAnnualConsumption" required>

        <div id="flexSection" class="hidden">
            <h3>Inserisci i dati per il calcolo dell'offerta Flex</h3>
            <label for="currentPUN">PUN della bolletta attuale:</label>
            <input type="number" id="currentPUN" step="any" required>

            <label for="spread">Spread con Fastweb (€):</label>
            <input type="number" id="spread" step="any" required>

            <label for="commercialCost">Costo di Commercializzazione Fastweb (€):</label>
            <input type="number" id="commercialCost" required>
        </div>

        <div id="fixSection" class="hidden">
            <h3>Inserisci i dati per il calcolo dell'offerta Fix</h3>
            <label for="fixedPUN">PUN Fisso Fastweb:</label>
            <input type="number" id="fixedPUN" step="any" required>

            <label for="fixedCommercialCost">Costo di Commercializzazione Fastweb:</label>
            <input type="number" id="fixedCommercialCost" required>
        </div>

        <button id="calculateBtn">Calcola</button>
    </div>

    <div id="resultSection" class="hidden">
        <h3>Risultati della simulazione</h3>
        <div id="resultDetails"></div>
    </div>

    <script>
        document.getElementById("startBtn").addEventListener("click", () => {
            document.querySelector("h1").classList.add("hidden");
            document.getElementById("startBtn").classList.add("hidden");
            document.getElementById("selectionSection").classList.remove("hidden");
        });

        document.getElementById("calculateBtn").addEventListener("click", () => {
            const billType = document.getElementById("billType").value;
            const userType = document.getElementById("userType").value;
            const currentCost = parseFloat(document.getElementById("currentCost").value);
            const currentConsumption = parseFloat(document.getElementById("currentConsumption").value);
            const currentAnnualConsumption = parseFloat(document.getElementById("currentAnnualConsumption").value);
            const currentPUN = parseFloat(document.getElementById("currentPUN").value);
            const spread = parseFloat(document.getElementById("spread").value);
            const commercialCost = parseFloat(document.getElementById("commercialCost").value);
            const fixedPUN = parseFloat(document.getElementById("fixedPUN").value);
            const fixedCommercialCost = parseFloat(document.getElementById("fixedCommercialCost").value);

            // Aggiungere scarto del 10% sul consumo
            const adjustedConsumption = currentConsumption * 1.10;

            // Aggiungere costo se utente "Non Residente"
            const additionalCost = (userType === "non_residente") ? 12 : 0;

            // Calcolare il prezzo al kWh attuale
            const currentPricePerKWh = currentCost / currentConsumption;

            // Calcoli delle offerte
            // Offerta Flex
            const flexCost = (adjustedConsumption * (currentPUN + spread)) + commercialCost + additionalCost;

            // Offerta Fix
            const fixCost = (adjustedConsumption * fixedPUN) + fixedCommercialCost + additionalCost;

            // Offerta Light
            const lightBaseCost = (billType === "mensile") ? 40 : 80;
            let lightCost = lightBaseCost * 12;
            if (currentAnnualConsumption > 1500) {
                const extraKWh = currentAnnualConsumption - 1500;
                lightCost += extraKWh * 0.45;
            }

            // Offerta Full
            const fullBaseCost = (billType === "mensile") ? 60 : 120;
            let fullCost = fullBaseCost * 12;
            if (currentAnnualConsumption > 2500) {
                const extraKWh = currentAnnualConsumption - 2500;
                fullCost += extraKWh * 0.45;
            }

            // Offerta Maxi
            const maxiBaseCost = (billType === "mensile") ? 90 : 180;
            let maxiCost = maxiBaseCost * 12;
            if (currentAnnualConsumption > 4000) {
                const extraKWh = currentAnnualConsumption - 4000;
                maxiCost += extraKWh * 0.45;
            }

            // Determina l'offerta più conveniente
            const allCosts = {
                "Flex": flexCost,
                "Fix": fixCost,
                "Light": lightCost,
                "Full": fullCost,
                "Maxi": maxiCost
            };

            const bestOffer = Object.keys(allCosts).reduce((a, b) => allCosts[a] < allCosts[b] ? a : b);

            // Mostra i risultati
            let resultText = `
                <p>Prezzo al kWh della bolletta attuale: ${currentPricePerKWh.toFixed(4)} €/kWh</p>
                <p>L'offerta più conveniente è: <strong>${bestOffer}</strong></p>
                <p>Motivo: </p>
            `;

            // Motivazione per la scelta dell'offerta migliore
            if (bestOffer === "Flex") {
                resultText += `<p>La Flex conviene per il suo PUN variabile e la combinazione con lo spread e il costo di commercializzazione.</p>`;
            } else if (bestOffer === "Fix") {
                resultText += `<p>La Fix conviene per il suo PUN fisso che consente una previsione stabile dei costi.</p>`;
            } else if (bestOffer === "Light") {
                resultText += `<p>L'Offerta Light conviene perchè il consumo annuo dell'utente è basso e non supera i limiti, mantenendo il costo fisso a un prezzo conveniente.</p>`;
            } else if (bestOffer === "Full") {
                resultText += `<p>L'Offerta Full offre una buona combinazione di prezzo e consumo, ma solo per consumi più alti.</p>`;
            } else {
                resultText += `<p>L'Offerta Maxi conviene per consumi molto elevati, ma non è adatta a consumi più bassi come il tuo.</p>`;
            }

            document.getElementById("resultDetails").innerHTML = resultText;
            document.getElementById("selectionSection").classList.add("hidden");
            document.getElementById("resultSection").classList.remove("hidden");
        });
    </script>
</body>
</html>
