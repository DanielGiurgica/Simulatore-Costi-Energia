<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulatore Energia</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .hidden { display: none; }
    .section { margin-bottom: 20px; }
    label, select, input { display: block; margin: 10px 0; }
    button { padding: 10px 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <div id="welcome" class="section">
    <h1>Benvenuto nel simulatore</h1>
    <button id="startBtn">Inizia</button>
  </div>

  <div id="selectionForm" class="section hidden">
    <label>Tipo di Bolletta:</label>
    <select id="billType">
      <option value="mensile">Mensile</option>
      <option value="bimestrale">Bimestrale</option>
    </select>

    <label>Tipo di Utente:</label>
    <select id="userType">
      <option value="residente">Residente</option>
      <option value="non-residente">Non Residente</option>
      <option value="partita-iva">Partita IVA</option>
    </select>
    <button id="toDataInput">Avanti</button>
  </div>

  <div id="dataInputForm" class="section hidden">
    <h3>Dati Generali</h3>
    <label>Costo Attuale Energia (&euro;): <input type="number" id="costoEnergia"></label>
    <label>Consumo Attuale (kWh): <input type="number" id="consumoAttuale"></label>
    <label>Consumo Annuale (kWh): <input type="number" id="consumoAnnuale"></label>

    <h3>Offerta Flex</h3>
    <label>PUN Bolletta Attuale (&euro;/kWh): <input type="number" id="punAttuale"></label>
    <label>Spread con Fastweb (&euro;): <input type="number" id="spread"></label>
    <label>Costo Commercializzazione Flex (&euro;): <input type="number" id="comFlex"></label>

    <h3>Offerta Fix</h3>
    <label>PUN Fisso Fastweb (&euro;/kWh): <input type="number" id="punFisso"></label>
    <label>Costo Commercializzazione Fix (&euro;): <input type="number" id="comFix"></label>

    <button id="calculateBtn">Calcola Offerta Migliore</button>
  </div>

  <div id="result" class="section hidden">
    <h2>L'offerta pi&ugrave; conveniente &egrave;:</h2>
    <p id="resultText"></p>
  </div>

  <script>
    document.getElementById("startBtn").onclick = () => {
      document.getElementById("welcome").classList.add("hidden");
      document.getElementById("selectionForm").classList.remove("hidden");
    };

    document.getElementById("toDataInput").onclick = () => {
      document.getElementById("selectionForm").classList.add("hidden");
      document.getElementById("dataInputForm").classList.remove("hidden");
    };

    document.getElementById("calculateBtn").onclick = () => {
      const bolletta = document.getElementById("billType").value;
      const mensile = bolletta === "mensile";

      const consumo = parseFloat(document.getElementById("consumoAttuale").value);
      const consumoAnnuale = parseFloat(document.getElementById("consumoAnnuale").value);

      const punAtt = parseFloat(document.getElementById("punAttuale").value);
      const spread = parseFloat(document.getElementById("spread").value);
      let comFlex = parseFloat(document.getElementById("comFlex").value);
      if (!mensile) comFlex *= 2;

      const punFix = parseFloat(document.getElementById("punFisso").value);
      let comFix = parseFloat(document.getElementById("comFix").value);
      if (!mensile) comFix *= 2;

      const flex = consumo * punAtt + spread + comFlex;
      const fix = consumo * punFix + comFix;

      const lightBase = mensile ? 40 : 80;
      const fullBase = mensile ? 60 : 120;
      const maxiBase = mensile ? 90 : 180;

      const extraLight = Math.max(0, consumoAnnuale - 1500);
      const extraFull = Math.max(0, consumoAnnuale - 2500);
      const extraMaxi = Math.max(0, consumoAnnuale - 4000);

      const light = lightBase + (extraLight * 0.45);
      const full = fullBase + (extraFull * 0.45);
      const maxi = maxiBase + (extraMaxi * 0.45);

      const offerte = { Flex: flex, Fix: fix, Light: light, Full: full, Maxi: maxi };
      const migliore = Object.keys(offerte).reduce((a, b) => offerte[a] < offerte[b] ? a : b);

      document.getElementById("dataInputForm").classList.add("hidden");
      document.getElementById("result").classList.remove("hidden");
      document.getElementById("resultText").textContent = `${migliore} con un costo stimato di â‚¬${offerte[migliore].toFixed(2)}`;
    };
  </script>
</body>
</html>

