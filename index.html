<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore Energia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #111;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        .container {
            padding: 20px;
        }
        h1, h2, p {
            text-align: center;
        }
        .section {
            margin-bottom: 20px;
        }
        .btn {
            background-color: #fbc531;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            color: #000;
            width: 100%;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
        }
        .input-group input, .input-group select {
            padding: 10px;
            width: 100%;
            font-size: 16px;
        }
        .hidden {
            display: none;
        }
        .result {
            margin-top: 20px;
            background-color: #333;
            padding: 15px;
        }
        .result p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Benvenuto nel Simulatore Energia</h1>
        
        <!-- Step 1 - Iniziale -->
        <div id="step1" class="section">
            <p>Benvenuto nel simulatore. Clicca "Inizia" per proseguire.</p>
            <button class="btn" id="startBtn">Inizia</button>
        </div>

        <!-- Step 2 - Selezione Tipo Bolletta e Tipo Utente -->
        <div id="step2" class="hidden section">
            <h2>Fase 1 - Seleziona Tipo Bolletta e Tipo Utente</h2>
            <div class="input-group">
                <label for="tipoBolletta">Tipo di Bolletta:</label>
                <select id="tipoBolletta">
                    <option value="">Seleziona</option>
                    <option value="mensile">Mensile</option>
                    <option value="bimestrale">Bimestrale</option>
                </select>
            </div>
            <div class="input-group">
                <label for="tipoUtente">Tipo di Utente:</label>
                <select id="tipoUtente">
                    <option value="">Seleziona</option>
                    <option value="residente">Residente</option>
                    <option value="nonResidente">Non Residente</option>
                    <option value="partitaIva">Partita IVA</option>
                </select>
            </div>
            <button class="btn" id="proseguiBtn">Prosegui</button>
        </div>

        <!-- Step 3 - Dati Generali -->
        <div id="step3" class="hidden section">
            <h2>Fase 2 - Inserisci Dati Generali</h2>
            <div class="input-group">
                <label for="costoEnergiaAttuale">Costo Attuale Energia (€ per kWh):</label>
                <input type="number" id="costoEnergiaAttuale" placeholder="Inserisci costo attuale" required>
            </div>
            <div class="input-group">
                <label for="punAttuale">PUN Attuale (€ per kWh):</label>
                <input type="number" id="punAttuale" placeholder="Inserisci PUN attuale" required>
            </div>
            <div class="input-group">
                <label for="spreadAttuale">Spread Attuale (€ per kWh):</label>
                <input type="number" id="spreadAttuale" placeholder="Inserisci spread attuale" required>
            </div>
            <div class="input-group">
                <label for="consumoAttuale">Consumo Attuale (kWh):</label>
                <input type="number" id="consumoAttuale" placeholder="Inserisci consumo attuale" required>
            </div>
            <div class="input-group">
                <label for="consumoAnnualeAttuale">Consumo Annuale Attuale (kWh):</label>
                <input type="number" id="consumoAnnualeAttuale" placeholder="Inserisci consumo annuale" required>
            </div>
            <button class="btn" id="calcolaBtn">Calcola Offerte</button>
        </div>

        <!-- Step 4 - Risultati -->
        <div id="result" class="hidden result">
            <h2>Risultati</h2>
            <p><strong>Risparmio a Bolletta: </strong><span id="risparmioBolleta"></span></p>
            <p><strong>Risparmio Annuale: </strong><span id="risparmioAnnuale"></span></p>
            <p><strong>Prezzo al kWh attuale: </strong><span id="prezzoKwAttuale"></span></p>
            <p><strong>Prezzo al kWh con Offerta Selezionata: </strong><span id="prezzoKwOfferta"></span></p>
            <p><strong>Motivazione del Risparmio: </strong><span id="motivazioneRisparmio"></span></p>
        </div>
    </div>

    <script>
        // Variabili globali
        let tipoBolletta, tipoUtente, costoEnergiaAttuale, punAttuale, spreadAttuale, consumoAttuale, consumoAnnualeAttuale;

        // Funzione per mostrare il passo successivo
        function mostraStep(step) {
            const allSteps = document.querySelectorAll('.section');
            allSteps.forEach(s => s.classList.add('hidden'));  // Nasconde tutti i passi
            document.getElementById(step).classList.remove('hidden');  // Mostra il passo selezionato
        }

        // Funzione per calcolare i costi
        function calcolaCosti() {
            costoEnergiaAttuale = parseFloat(document.getElementById('costoEnergiaAttuale').value);
            punAttuale = parseFloat(document.getElementById('punAttuale').value);
            spreadAttuale = parseFloat(document.getElementById('spreadAttuale').value);
            consumoAttuale = parseFloat(document.getElementById('consumoAttuale').value);
            consumoAnnualeAttuale = parseFloat(document.getElementById('consumoAnnualeAttuale').value);

            // Aggiungi il 10% di margine errore per il consumo
            consumoAttuale *= 1.1;
            consumoAnnualeAttuale *= 1.1;

            // Condizioni per Non Residente
            const costoExtraNonResidente = (tipoUtente === 'nonResidente') ? 12 : 0;

            // Costo Offerta Flex
            const costoCommercializzazioneFlex = tipoBolletta === 'bimestrale' ? 5 * 2 : 5;
            const costoFlex = (consumoAttuale * (costoEnergiaAttuale + spreadAttuale)) + costoCommercializzazioneFlex + costoExtraNonResidente;

            // Costo Offerta Fix
            const costoCommercializzazioneFix = tipoBolletta === 'bimestrale' ? 6 * 2 : 6;
            const costoFix = (consumoAttuale * punAttuale) + costoCommercializzazioneFix + costoExtraNonResidente;

            // Costo Offerta Light
            const costoFissoLight = tipoBolletta === 'bimestrale' ? 80 : 40;
            const kwhExtraLight = consumoAnnualeAttuale > 1500 ? (consumoAnnualeAttuale - 1500) * 0.45 : 0;
            const costoLight = costoFissoLight + kwhExtraLight + costoExtraNonResidente;

            // Costo Offerta Full
            const costoFissoFull = tipoBolletta === 'bimestrale' ? 120 : 60;
            const kwhExtraFull = consumoAnnualeAttuale > 2500 ? (consumoAnnualeAttuale - 2500) * 0.45 : 0;
            const costoFull = costoFissoFull + kwhExtraFull + costoExtraNonResidente;

            // Costo Offerta Maxi
            const costoFissoMaxi = tipoBolletta === 'bimestrale' ? 180 : 90;
            const kwhExtraMaxi = consumoAnnualeAttuale > 4000 ? (consumoAnnualeAttuale - 4000) * 0.45 : 0;
            const costoMaxi = costoFissoMaxi + kwhExtraMaxi + costoExtraNonResidente;

            // Confronto con la bolletta attuale
            const costoAttualeAnnuale = costoEnergiaAttuale * consumoAnnualeAttuale;
            const risparmioBolleta = costoAttualeAnnuale - Math.min(costoFlex, costoFix, costoLight, costoFull, costoMaxi);
            const risparmioAnnuale = risparmioBolleta;

            // Aggiornamento Risultati
            document.getElementById('risparmioBolleta').innerText = `€ ${risparmioBolleta.toFixed(2)}`;
            document.getElementById('risparmioAnnuale').innerText = `€ ${risparmioAnnuale.toFixed(2)}`;
            document.getElementById('prezzoKwAttuale').innerText = `€ ${costoEnergiaAttuale.toFixed(2)} per kWh`;
            document.getElementById('prezzoKwOfferta').innerText = `€ ${(Math.min(costoFlex, costoFix, costoLight, costoFull, costoMaxi) / consumoAttuale).toFixed(2)} per kWh`;

            const motivazione = `Il risparmio è dovuto al confronto tra il costo della tua attuale bolletta e l'offerta più conveniente (Flex, Fix, Light, Full o Maxi).`;
            document.getElementById('motivazioneRisparmio').innerText = motivazione;

            mostraStep('result');
        }

        // Event Listeners
        document.getElementById('startBtn').addEventListener('click', () => mostraStep('step2'));
        document.getElementById('proseguiBtn').addEventListener('click', () => {
            tipoBolletta = document.getElementById('tipoBolletta').value;
            tipoUtente = document.getElementById('tipoUtente').value;

            if (tipoBolletta && tipoUtente) {
                mostraStep('step3');
            } else {
                alert('Per favore, completa tutti i campi.');
            }
        });
        document.getElementById('calcolaBtn').addEventListener('click', calcolaCosti);
    </script>
</body>
</html>
