<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulatore Energia</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    label, select, input { display: block; margin: 10px 0; }
    .section { margin-bottom: 30px; }
    button { padding: 10px 15px; font-size: 16px; }
    #result { font-weight: bold; margin-top: 20px; }
  </style>
</head>
<body>
  <div id="welcome">
    <h1>Benvenuto nel simulatore</h1>
    <button onclick="startSimulation()">Inizia</button>
  </div>

  <div id="simulator" class="hidden">
    <div class="section">
      <label for="billingType">Tipo di Bolletta:</label>
      <select id="billingType">
        <option value="mensile">Mensile</option>
        <option value="bimestrale">Bimestrale</option>
      </select>

      <label for="userType">Tipo di Utente:</label>
      <select id="userType">
        <option value="residente">Residente</option>
        <option value="non_residente">Non Residente</option>
        <option value="partita_iva">Partita IVA</option>
      </select>
    </div>

    <div class="section">
      <label>Costo Attuale Energia (€): <input type="number" id="costoAttuale"></label>
      <label>Consumo Attuale (kW): <input type="number" id="consumoAttuale"></label>
      <label>Consumo Annuale Attuale (kW): <input type="number" id="consumoAnnuale"></label>
    </div>

    <div class="section">
      <h3>Inserire i dati per il calcolo dell'offerta Flex</h3>
      <label>PUN della bolletta attuale (€): <input type="number" id="punAttuale"></label>
      <label>Spread con Fastweb (€): <input type="number" id="spread"></label>
      <label>Costo di Commercializzazione Fastweb (€): <input type="number" id="commercialeFlex"></label>
    </div>

    <div class="section">
      <h3>Inserire i dati per il calcolo dell'offerta Fix</h3>
      <label>PUN Fisso Fastweb (€): <input type="number" id="punFisso"></label>
      <label>Costo di Commercializzazione Fastweb (€): <input type="number" id="commercialeFix"></label>
    </div>

    <button onclick="calcolaRisultati()">Calcola</button>

    <div id="result"></div>
  </div>

  <script>
    function startSimulation() {
      document.getElementById('welcome').classList.add('hidden');
      document.getElementById('simulator').classList.remove('hidden');
    }

    function calcolaRisultati() {
      const tipoBolletta = document.getElementById('billingType').value;
      const tipoUtente = document.getElementById('userType').value;
      const consumo = parseFloat(document.getElementById('consumoAttuale').value) * 1.1;
      const consumoAnnuale = parseFloat(document.getElementById('consumoAnnuale').value) * 1.1;
      const costoAttuale = parseFloat(document.getElementById('costoAttuale').value);

      const pun = parseFloat(document.getElementById('punAttuale').value);
      const spread = parseFloat(document.getElementById('spread').value);
      const commercialeFlex = parseFloat(document.getElementById('commercialeFlex').value) * (tipoBolletta === 'bimestrale' ? 2 : 1);

      const punFisso = parseFloat(document.getElementById('punFisso').value);
      const commercialeFix = parseFloat(document.getElementById('commercialeFix').value);

      const costoExtraMensile = tipoUtente === 'non_residente' ? 12 : 0;
      const moltiplicatoreMensile = tipoBolletta === 'mensile' ? 12 : 6;
      const moltiplicatoreBolletta = tipoBolletta === 'mensile' ? 1 : 2;

      // Flex
      const punTotaleFlex = pun + spread;
      const flex = (consumo * punTotaleFlex) + commercialeFlex + (costoExtraMensile * moltiplicatoreBolletta);
      const flexAnnuale = flex * moltiplicatoreMensile;

      // Fix
      const fix = (consumo * punFisso) + commercialeFix + (costoExtraMensile * moltiplicatoreBolletta);
      const fixAnnuale = fix * moltiplicatoreMensile;

      // Light
      let light = 40 * moltiplicatoreMensile + (consumoAnnuale > 1500 ? (consumoAnnuale - 1500) * 0.45 : 0) + (costoExtraMensile * moltiplicatoreMensile);

      // Full
      let full = 60 * moltiplicatoreMensile + (consumoAnnuale > 2500 ? (consumoAnnuale - 2500) * 0.45 : 0) + (costoExtraMensile * moltiplicatoreMensile);

      // Maxi
      let maxi = 90 * moltiplicatoreMensile + (consumoAnnuale > 4000 ? (consumoAnnuale - 4000) * 0.45 : 0) + (costoExtraMensile * moltiplicatoreMensile);

      const risultati = [
        { nome: "Flex", costo: flexAnnuale, formula: `(${consumo.toFixed(2)} × (${pun.toFixed(2)} + ${spread.toFixed(2)})) + ${commercialeFlex.toFixed(2)} + (${costoExtraMensile} × ${moltiplicatoreBolletta})` },
        { nome: "Fix", costo: fixAnnuale, formula: `(${consumo.toFixed(2)} × ${punFisso.toFixed(2)}) + ${commercialeFix.toFixed(2)} + (${costoExtraMensile} × ${moltiplicatoreBolletta})` },
        { nome: "Light", costo: light, formula: `40 × ${moltiplicatoreMensile} + Extra: ${(consumoAnnuale > 1500 ? (consumoAnnuale - 1500).toFixed(2) + ' × 0.45' : '0')} + ${costoExtraMensile} × ${moltiplicatoreMensile}` },
        { nome: "Full", costo: full, formula: `60 × ${moltiplicatoreMensile} + Extra: ${(consumoAnnuale > 2500 ? (consumoAnnuale - 2500).toFixed(2) + ' × 0.45' : '0')} + ${costoExtraMensile} × ${moltiplicatoreMensile}` },
        { nome: "Maxi", costo: maxi, formula: `90 × ${moltiplicatoreMensile} + Extra: ${(consumoAnnuale > 4000 ? (consumoAnnuale - 4000).toFixed(2) + ' × 0.45' : '0')} + ${costoExtraMensile} × ${moltiplicatoreMensile}` }
      ];

      risultati.sort((a, b) => a.costo - b.costo);

      const risparmioBolletta = costoAttuale - (risultati[0].costo / moltiplicatoreMensile);
      const risparmioAnnuale = (costoAttuale * moltiplicatoreMensile) - risultati[0].costo;

      document.getElementById("result").innerHTML = `
        L'offerta più conveniente è: <strong>${risultati[0].nome}</strong><br>
        Formula: ${risultati[0].formula}<br>
        Risparmio per bolletta: <strong>€${risparmioBolletta.toFixed(2)}</strong><br>
        Risparmio annuale: <strong>€${risparmioAnnuale.toFixed(2)}</strong>
      `;
    }
  </script>
</body>
</html>
