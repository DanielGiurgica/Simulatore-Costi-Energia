<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulatore Offerta Energetica</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #fff8e1; /* Giallo chiaro */
            color: black;
            padding: 20px;
        }
        h1 {
            color: black;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .button {
            background-color: yellow;
            color: black;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .section {
            margin-bottom: 20px;
        }
        .divider {
            border-top: 2px solid black;
            margin: 20px 0;
        }
        .result {
            font-weight: bold;
            margin-top: 20px;
        }
        .calculation {
            font-style: italic;
        }
    </style>
</head>
<body>

    <h1>Benvenuto nel Simulatore Energia</h1>
    <div id="welcomeScreen">
        <p>Benvenuto nel simulatore. Clicca "Inizia" per iniziare.</p>
        <button class="button" onclick="startSimulation()">Inizia</button>
    </div>

    <div id="selectionScreen" class="hidden">
        <div class="section">
            <label for="userType">Tipo di Utente:</label>
            <select id="userType">
                <option value="residente">Residente</option>
                <option value="nonResidente">Non Residente</option>
                <option value="partitaIVA">Partita IVA</option>
            </select>
        </div>
        <div class="section">
            <label for="billType">Tipo di Bolletta:</label>
            <select id="billType">
                <option value="mensile">Mensile</option>
                <option value="bimestrale">Bimestrale</option>
            </select>
        </div>
        <button class="button" onclick="nextScreen()">Avanti</button>
    </div>

    <div id="dataInputScreen" class="hidden">
        <div class="section">
            <label for="currentCost">Costo Attuale Energia (€):</label>
            <input type="number" id="currentCost" required>
        </div>
        <div class="section">
            <label for="currentConsumption">Consumo Attuale (kWh):</label>
            <input type="number" id="currentConsumption" required>
        </div>
        <div class="section">
            <label for="currentAnnualConsumption">Consumo Annuale Attuale (kWh):</label>
            <input type="number" id="currentAnnualConsumption" required>
        </div>
        
        <div class="divider"></div>
        
        <div class="section">
            <label for="currentPUN">PUN della bolletta attuale:</label>
            <input type="number" id="currentPUN" required>
        </div>
        <div class="section">
            <label for="spreadFastweb">Spread con Fastweb (€):</label>
            <input type="number" id="spreadFastweb" required>
        </div>
        <div class="section">
            <label for="commercializationCost">Costo di Commercializzazione Fastweb (€):</label>
            <input type="number" id="commercializationCost" required>
        </div>

        <div class="divider"></div>

        <div class="section">
            <label for="fixedPUN">PUN Fisso Fastweb:</label>
            <input type="number" id="fixedPUN" required>
        </div>
        <div class="section">
            <label for="fixedCommercializationCost">Costo di Commercializzazione Fastweb:</label>
            <input type="number" id="fixedCommercializationCost" required>
        </div>

        <button class="button" onclick="calculateResults()">Calcola</button>
    </div>

    <div id="resultScreen" class="hidden">
        <div class="result" id="bestOffer"></div>
        <div class="result" id="savingPerMonth"></div>
        <div class="result" id="savingPerYear"></div>
        <div class="calculation" id="calculationDetails"></div>
    </div>

    <script>
        function startSimulation() {
            document.getElementById("welcomeScreen").classList.add("hidden");
            document.getElementById("selectionScreen").classList.remove("hidden");
        }

        function nextScreen() {
            const userType = document.getElementById("userType").value;
            const billType = document.getElementById("billType").value;

            // Check if the user has selected both values
            if (!userType || !billType) {
                alert("Seleziona entrambi i campi.");
                return;
            }

            document.getElementById("selectionScreen").classList.add("hidden");
            document.getElementById("dataInputScreen").classList.remove("hidden");
        }

        function calculateResults() {
            const userType = document.getElementById("userType").value;
            const billType = document.getElementById("billType").value;
            const currentCost = parseFloat(document.getElementById("currentCost").value);
            const currentConsumption = parseFloat(document.getElementById("currentConsumption").value);
            const currentAnnualConsumption = parseFloat(document.getElementById("currentAnnualConsumption").value);
            const currentPUN = parseFloat(document.getElementById("currentPUN").value);
            const spreadFastweb = parseFloat(document.getElementById("spreadFastweb").value);
            const commercializationCost = parseFloat(document.getElementById("commercializationCost").value);
            const fixedPUN = parseFloat(document.getElementById("fixedPUN").value);
            const fixedCommercializationCost = parseFloat(document.getElementById("fixedCommercializationCost").value);

            // Add 10% extra consumption
            const adjustedConsumption = currentConsumption * 1.1;

            // Calcolo Costo Flex
            const flexCost = (adjustedConsumption * (currentPUN + spreadFastweb)) + commercializationCost;
            
            // Calcolo Costo Fix
            const fixCost = (adjustedConsumption * fixedPUN) + fixedCommercializationCost;

            // Calcolo Costo Light
            const lightLimit = 1500;
            const lightBaseCost = (billType === "mensile") ? 40 : 80;
            let lightExtraCost = 0;
            if (currentAnnualConsumption > lightLimit) {
                lightExtraCost = (currentAnnualConsumption - lightLimit) * 0.45;
            }
            const lightCost = lightBaseCost + lightExtraCost;

            // Calcolo Costo Full
            const fullLimit = 2500;
            const fullBaseCost = (billType === "mensile") ? 60 : 120;
            let fullExtraCost = 0;
            if (currentAnnualConsumption > fullLimit) {
                fullExtraCost = (currentAnnualConsumption - fullLimit) * 0.45;
            }
            const fullCost = fullBaseCost + fullExtraCost;

            // Calcolo Costo Maxi
            const maxiLimit = 4000;
            const maxiBaseCost = (billType === "mensile") ? 90 : 180;
            let maxiExtraCost = 0;
            if (currentAnnualConsumption > maxiLimit) {
                maxiExtraCost = (currentAnnualConsumption - maxiLimit) * 0.45;
            }
            const maxiCost = maxiBaseCost + maxiExtraCost;

            // Consider Non Residente extra cost
            const extraCostNonResidente = (userType === "nonResidente") ? 12 : 0;

            // Apply extra cost to each calculation
            const finalFlexCost = flexCost + extraCostNonResidente;
            const finalFixCost = fixCost + extraCostNonResidente;
            const finalLightCost = lightCost + extraCostNonResidente;
            const finalFullCost = fullCost + extraCostNonResidente;
            const finalMaxiCost = maxiCost + extraCostNonResidente;

            // Determinazione dell'offerta più conveniente
            const allCosts = [
                { name: "Flex", cost: finalFlexCost },
                { name: "Fix", cost: finalFixCost },
                { name: "Light", cost: finalLightCost },
                { name: "Full", cost: finalFullCost },
                { name: "Maxi", cost: finalMaxiCost }
            ];

            // Trova l'offerta con il costo più basso
            const bestOffer = allCosts.reduce((prev, curr) => (prev.cost < curr.cost ? prev : curr));

            // Calcolo risparmio
            const savingPerMonth = (currentCost * currentConsumption) - bestOffer.cost;
            const savingPerYear = savingPerMonth * 12;

            // Mostra risultati
            document.getElementById("bestOffer").textContent = `L'offerta migliore è: ${bestOffer.name}`;
            document.getElementById("savingPerMonth").textContent = `Risparmio per bolletta: €${savingPerMonth.toFixed(2)}`;
            document.getElementById("savingPerYear").textContent = `Risparmio annuale: €${savingPerYear.toFixed(2)}`;
            document.getElementById("calculationDetails").textContent = `Calcolo per ${bestOffer.name}: ${bestOffer.cost.toFixed(2)}`;
            
            document.getElementById("dataInputScreen").classList.add("hidden");
            document.getElementById("resultScreen").classList.remove("hidden");
        }
    </script>
</body>
</html>
