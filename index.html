<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulatore Energia</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fffbe6;
      color: #333;
      padding: 20px;
    }
    .hidden { display: none; }
    .section { margin-bottom: 20px; }
    button { padding: 10px 20px; background-color: #ffd700; border: none; cursor: pointer; }
    input, select { padding: 5px; margin: 5px 0; width: 100%; }
    .result { font-weight: bold; font-size: 1.2em; margin-top: 20px; background-color: #f0f0f0; padding: 10px; }
  </style>
</head>
<body>
  <div id="welcome">
    <h1>Benvenuto nel simulatore</h1>
    <button onclick="startSimulation()">Inizia</button>
  </div>

  <div id="form-section" class="hidden">
    <div class="section">
      <label>Tipo di Bolletta:</label>
      <select id="bolletta">
        <option value="mensile">Mensile</option>
        <option value="bimestrale">Bimestrale</option>
      </select>

      <label>Tipo di Utente:</label>
      <select id="utente">
        <option value="residente">Residente</option>
        <option value="non_residente">Non Residente</option>
        <option value="partita_iva">Partita IVA</option>
      </select>
    </div>

    <div class="section">
      <label>Costo Attuale Energia (€):</label>
      <input type="number" id="costo-attuale">

      <label>Consumo Attuale (kW):</label>
      <input type="number" id="consumo-attuale">

      <label>Consumo Annuale Attuale (kW):</label>
      <input type="number" id="consumo-annuo">
    </div>

    <div class="section">
      <h3>Inserire i dati per il calcolo dell'offerta Flex</h3>
      <label>PUN della bolletta attuale:</label>
      <input type="number" id="pun-bolletta" step="0.01">

      <label>Spread con Fastweb (€):</label>
      <input type="number" id="spread" step="0.01">

      <label>Costo di Commercializzazione Fastweb:</label>
      <input type="number" id="com-flex">
    </div>

    <div class="section">
      <h3>Inserire i dati per il calcolo dell'offerta Fix</h3>
      <label>PUN Fisso Fastweb:</label>
      <input type="number" id="pun-fix" step="0.01">

      <label>Costo di Commercializzazione Fastweb:</label>
      <input type="number" id="com-fix">
    </div>

    <button onclick="calcola()">Calcola</button>

    <div class="result" id="risultato"></div>
  </div>

  <script>
    function startSimulation() {
      document.getElementById("welcome").classList.add("hidden");
      document.getElementById("form-section").classList.remove("hidden");
    }

    function calcola() {
      const bolletta = document.getElementById("bolletta").value;
      const utente = document.getElementById("utente").value;
      const mensile = bolletta === "mensile" ? 1 : 2;

      const costoAttuale = parseFloat(document.getElementById("costo-attuale").value);
      const consumo = parseFloat(document.getElementById("consumo-attuale").value) * 1.1;
      const consumoAnnuo = parseFloat(document.getElementById("consumo-annuo").value) * 1.1;

      const pun = parseFloat(document.getElementById("pun-bolletta").value);
      const spread = parseFloat(document.getElementById("spread").value);
      const punTotale = pun + spread;
      let comFlex = parseFloat(document.getElementById("com-flex").value);
      if (mensile === 2) comFlex *= 2;

      const punFix = parseFloat(document.getElementById("pun-fix").value);
      let comFix = parseFloat(document.getElementById("com-fix").value);
      if (mensile === 2) comFix *= 2;

      const sovrapprezzo = utente === "non_residente" ? 12 * mensile : 0;

      const costoFlex = (consumo * punTotale) + comFlex + sovrapprezzo;
      const costoFix = (consumo * punFix) + comFix + sovrapprezzo;

      const lightBase = 40 * mensile;
      const fullBase = 60 * mensile;
      const maxiBase = 90 * mensile;

      const lightExtra = consumoAnnuo > 1500 ? (consumoAnnuo - 1500) * 0.45 : 0;
      const fullExtra = consumoAnnuo > 2500 ? (consumoAnnuo - 2500) * 0.45 : 0;
      const maxiExtra = consumoAnnuo > 4000 ? (consumoAnnuo - 4000) * 0.45 : 0;

      const costoLight = lightBase + lightExtra + sovrapprezzo * 12;
      const costoFull = fullBase + fullExtra + sovrapprezzo * 12;
      const costoMaxi = maxiBase + maxiExtra + sovrapprezzo * 12;

      const offerte = [
        { nome: "Flex", costo: costoFlex },
        { nome: "Fix", costo: costoFix },
        { nome: "Light", costo: costoLight },
        { nome: "Full", costo: costoFull },
        { nome: "Maxi", costo: costoMaxi }
      ];

      offerte.sort((a, b) => a.costo - b.costo);
      const migliore = offerte[0];

      const risparmioBolletta = costoAttuale - migliore.costo;
      const risparmioAnnuale = risparmioBolletta * (mensile === 1 ? 12 : 6);

      const descrizione = `L'offerta più conveniente è <b>${migliore.nome}</b>.<br>
        Risparmi circa <b>${risparmioBolletta.toFixed(2)}€</b> per bolletta e <b>${risparmioAnnuale.toFixed(2)}€</b> all'anno.<br>
        Formula usata: ${(migliore.nome === "Flex") ? `(${consumo.toFixed(2)} × ${punTotale.toFixed(2)}) + ${comFlex} + ${sovrapprezzo}` :
                       (migliore.nome === "Fix") ? `(${consumo.toFixed(2)} × ${punFix}) + ${comFix} + ${sovrapprezzo}` :
                       `${mensile === 1 ? lightBase : (migliore.nome === "Full" ? fullBase : maxiBase)} + Sovrapprezzo + Extra`}$`;

      document.getElementById("risultato").innerHTML = descrizione;
    }
  </script>
</body>
</html>
